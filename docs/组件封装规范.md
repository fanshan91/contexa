# 组件封装规范（Web）

本规范用于指导 `apps/web` 的可复用组件封装，目标是：一致的语义化 Design Tokens、一致的交互与可访问性、可维护的类型与目录结构。

## 1. 目录与命名

- 原子 UI（shadcn 风格、Radix 组合优先）：`apps/web/components/ui/*`
  - 命名：kebab-case 文件名（与现有一致），导出 PascalCase 组件名（如 `button.tsx` → `Button`）。
- 业务通用（由多个原子组件组合，跨页面复用）：`apps/web/components/common/*`
  - 命名：kebab-case 文件名，导出 PascalCase（如 `status-badge.tsx` → `StatusBadge`）。
- 领域/页面级（只服务某个页面或 feature）：放在对应路由或 feature 目录内，避免进入 `common`。

## 2. 语义化 Tokens（强制）

- 禁止硬编码颜色（如 `text-gray-700`、`bg-blue-500`、`border-slate-200`）。
- 使用语义化类名：`bg-background`、`text-foreground`、`border-input`、`ring-ring`、`text-muted-foreground`、`bg-accent` 等。
- Dark Mode 依赖 CSS 变量自动切换，避免为颜色显式写 `dark:`；如遇到 Radix 状态/无变量可表达的情况，允许最小化使用并优先复用现有风格。

## 3. Props 与类型（TypeScript）

- Props 设计原则：
  - 对 Radix 组件封装：优先使用 `React.ComponentProps<typeof Primitive.X>` 继承类型。
  - 对 DOM 元素封装：使用 `React.ComponentProps<"div">` 等，保持 HTML 属性完整性。
  - 约定保留 `className` 并通过 `cn()` 合并。
  - 需要变体（variant/size）：使用 `class-variance-authority (cva)` + `VariantProps`，与现有 `Button` 一致。
- 导出：
  - 同一文件内同时导出主组件与子组件（如 `Dialog` + `DialogHeader`/`DialogFooter`）。
  - 必要时导出 `*Variants`（如 `buttonVariants`），用于组合组件复用样式。

## 4. Client/Server 边界

- 使用 Radix（交互、Portal、Focus 管理等）或 React hooks 的组件必须是 Client Component：文件首行添加 `"use client";`。
- 纯展示（无 hooks/无 Radix state）组件可保持 Server Component（默认）。

## 5. 可访问性（A11y）

- 组件必须支持键盘导航与可访问语义：
  - 交互控件具备可聚焦状态（`focus-visible:*`），并且不移除 outline 而不提供替代。
  - `disabled`/`aria-invalid` 等状态样式需要与现有组件一致。
  - Tooltip、Dialog、Sheet 等必须依赖 Radix 的可访问实现，不自行拼装。
- 图标按钮或仅图标的交互必须提供可访问名称：`aria-label` 或可见文本。

## 6. 结构与组合

- 复杂组件优先拆分为子组件（示例：`DialogContent` + `DialogHeader`/`DialogFooter`）。
- 共享逻辑（受控/非受控、开关状态等）优先下沉为 hooks：`apps/web/lib/hooks/*`。

## 7. 文档与示例

- 每个通用组件应提供：
  - Props/变体说明
  - 最小可用示例
  - 注意事项（如 Client Component、可访问性要求）

